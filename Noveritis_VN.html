<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noveritis - Công Bố Lễ Phục Sinh</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');
        body {
            font-family: Inter, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }
        input, select, button {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #DA251D; /* Màu đỏ của quốc kỳ Việt Nam */
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background-color: #a00000;
        }
        canvas {
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 100%;
            height: auto;
        }
        .footer-note {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>

    <div class="controls">
        <div>
            <label for="yearInput">Năm Phụng Vụ:</label>
            <input type="number" id="yearInput" value="2025" min="1900" max="2100">
        </div>
        
        <div>
            <label for="provinceSelect">Giáo tỉnh (Lễ Lên Trời):</label>
            <select id="provinceSelect">
                <option value="sunday">Huế & Sài Gòn (Dời vào Chúa Nhật)</option>
                <option value="thursday">Hà Nội (Giữ Thứ Năm)</option>
            </select>
        </div>

        <button onclick="generateNoveritis()">Tạo Văn Bản</button>
        <button onclick="downloadImage()">Tải Ảnh Về</button>
    </div>

    <canvas id="noveritisCanvas" width="1200" height="1600"></canvas>
    <div class="footer-note">Dựa trên bản dịch 2024 của UB Phụng Tự - HĐGMVN</div>

<script>
    // --- LOGIC TÍNH TOÁN NGÀY LỄ ---

    function getEasterDate(year) {
        const a = year % 19;
        const b = Math.floor(year / 100);
        const c = year % 100;
        const d = Math.floor(b / 4);
        const e = b % 4;
        const f = Math.floor((b + 8) / 25);
        const g = Math.floor((b - f + 1) / 3);
        const h = (19 * a + b - d - g + 15) % 30;
        const i = Math.floor(c / 4);
        const k = c % 4;
        const l = (32 + 2 * e + 2 * i - h - k) % 7;
        const m = Math.floor((a + 11 * h + 22 * l) / 451);
        const month = Math.floor((h + l - 7 * m + 114) / 31); // 3 = March, 4 = April
        const day = ((h + l - 7 * m + 114) % 31) + 1;
        return new Date(year, month - 1, day);
    }

    function addDays(date, days) {
        const result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
    }

    function getAdventSunday(year) {
        // Tìm Chúa Nhật gần nhất với 30/11 (hoặc Chúa Nhật thứ 4 trước Giáng Sinh)
        // Cách tính chuẩn: Chúa Nhật gần nhất với 30/11
        const nov30 = new Date(year, 10, 30); // Tháng 11 là index 10
        const dayOfWeek = nov30.getDay(); // 0 là CN
        
        // Nếu 30/11 là CN -> Chính nó
        // Nếu 30/11 là Thứ 2 (1) -> Lùi về 29 (sai, phải là CN gần nhất, tức 03/12? Không)
        // Quy tắc: CN I Mùa Vọng là CN trong khoảng 27/11 đến 3/12.
        
        let advent = new Date(year, 10, 30);
        if (dayOfWeek === 0) {
            // advent là 30/11
        } else if (dayOfWeek <= 3) {
            // Gần về phía trước (ví dụ Thứ 2, 3) -> Trừ dayOfWeek
            // Nhưng quy tắc Phụng vụ: CN 1 Mùa Vọng luôn là 4 tuần trước Giáng Sinh.
            // Hãy tính từ Giáng Sinh lùi lại cho chắc chắn.
            const christmas = new Date(year, 11, 25);
            const xmasDay = christmas.getDay(); // 0-6
            // CN ngay trước Giáng sinh là Mùa Vọng 4.
            // xmasDay = 0 (CN) -> MV4 = 18/12 -> MV1 = 27/11
            // xmasDay = 1 (T2) -> MV4 = 24/12 -> MV1 = 03/12
            // xmasDay = 2 (T3) -> MV4 = 23/12 -> MV1 = 02/12
            // ...
            const daysToSubtract = (xmasDay === 0) ? 7 : xmasDay; // Nếu Noel là CN, lùi 7 ngày về CN trước đó
            const fourthAdvent = addDays(christmas, -daysToSubtract);
            advent = addDays(fourthAdvent, -21); // Lùi thêm 3 tuần
        } else {
             // Logic trên đã bao quát hết
            const christmas = new Date(year, 11, 25);
            const daysToSubtract = (christmas.getDay() === 0) ? 7 : christmas.getDay();
            const fourthAdvent = addDays(christmas, -daysToSubtract);
            advent = addDays(fourthAdvent, -21);
        }
        return advent;
    }

    function formatDateVN(date) {
        // Format: ngày ... tháng ...
        return `ngày ${date.getDate()} tháng ${date.getMonth() + 1}`;
    }

    // --- LOGIC VẼ CANVAS ---

    function generateNoveritis() {
        const canvas = document.getElementById('noveritisCanvas');
        const ctx = canvas.getContext('2d');
        const year = parseInt(document.getElementById('yearInput').value);
        const province = document.getElementById('provinceSelect').value;

        // 1. Tính toán ngày
        const easter = getEasterDate(year);
        const ashWed = addDays(easter, -46);
        
        // Lễ Lên Trời: Hà Nội (T5) = Easter + 39; Huế/SG (CN) = Easter + 42
        const ascension = (province === 'thursday') ? addDays(easter, 39) : addDays(easter, 42);
        
        const pentecost = addDays(easter, 49);
        
        // Mình Máu Thánh: VN luôn dời vào CN -> Easter + 63 (Theo prompt)
        const corpusChristi = addDays(easter, 63);
        
        const firstAdvent = getAdventSunday(year);
        // Kitô Vua: Chúa Nhật cuối cùng năm phụng vụ = CN trước CN I Mùa Vọng (của năm tới? Không, của năm hiện tại kết thúc)
        // Chúa nhật I Mùa Vọng được tính ở trên là bắt đầu năm phụng vụ MỚI (cuối năm dương lịch).
        // Lễ Kitô Vua là 1 tuần trước đó.
        const christKing = addDays(firstAdvent, -7);

        // 2. Thiết lập nền và Font
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Background giả giấy
        ctx.fillStyle = "#FDFBF7"; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Viền
        ctx.strokeStyle = "#800000";
        ctx.lineWidth = 5;
        ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);
        ctx.lineWidth = 2;
        ctx.strokeRect(30, 30, canvas.width - 60, canvas.height - 60);

        // Cấu hình Text
        const startX = 100;
        const startY = 150;
        const lineHeight = 60;
        const maxWidth = canvas.width - 200;
        
        // --- VẼ TIÊU ĐỀ ---
        ctx.fillStyle = "#DA251D"; // The red of the national flag of Vietnam
        ctx.font = "bold 40px 'EB Garamond'";
        ctx.textAlign = "center";
        ctx.fillText("LỜI CÔNG BỐ LONG TRỌNG VỀ LỄ PHỤC SINH", canvas.width / 2, 100);
        ctx.font = "bold 30px 'EB Garamond'";
        ctx.fillText(`Năm Phụng Vụ ${year - 1} - ${year} (hoặc Năm Dương Lịch ${year})`, canvas.width / 2, 150);

        // --- HÀM VẼ ĐOẠN VĂN ---
        let currentY = 220;
        ctx.textAlign = "left";
        
        function drawParagraph(text, isRed = false, isBold = false, indent = 0) {
            ctx.fillStyle = isRed ? "#DA251D" : "#000000";
            ctx.font = `${isBold ? "bold" : "normal"} 32px 'EB Garamond'`;
            
            const words = text.split(' ');
            let line = '';
            
            // Xử lý indent đầu dòng
            let x = startX + indent;

            for(let n = 0; n < words.length; n++) {
                let testLine = line + words[n] + ' ';
                let metrics = ctx.measureText(testLine);
                let testWidth = metrics.width;
                
                if (testWidth > maxWidth - indent && n > 0) {
                    ctx.fillText(line, x, currentY);
                    line = words[n] + ' ';
                    currentY += lineHeight;
                    x = startX; // Reset x về lề trái cho dòng tiếp theo
                    indent = 0; // Chỉ indent dòng đầu tiên của đoạn
                } else {
                    line = testLine;
                }
            }
            ctx.fillText(line, x, currentY);
            currentY += lineHeight;
        }

        // --- VẼ NỘI DUNG ---
        
        // Mở đầu
        drawParagraph("Anh chị em thân mến, anh chị em hãy biết rằng:");
        currentY += 10;
        
        drawParagraph("Nhờ Thiên Chúa rộng lòng thương xót, mà chúng ta đã hân hoan mừng Đại Lễ Giáng Sinh của Đức Giêsu Kitô Chúa chúng ta thế nào; thì hôm nay chúng tôi cũng loan báo cho anh chị em tin vui về Đại Lễ Phục Sinh của chính Đấng Cứu Độ Chúng Ta như thế.", false, false, 40);
        
        currentY += 20;

        // 1. Lễ Tro
        drawParagraph(`1. ${formatDateVN(ashWed)} là Thứ Tư Lễ Tro, bắt đầu Mùa Chay Thánh.`);
        
        // 2. Phục Sinh
        drawParagraph(`2. ${formatDateVN(easter)} anh chị em sẽ vui mừng cử hành Lễ Phục Sinh của Đức Giêsu Kitô Chúa Chúng Ta.`);
        
        // 3. Lên Trời
        drawParagraph(`3. ${formatDateVN(ascension)} sẽ là Lễ Đức Giêsu Kitô Chúa Chúng Ta Lên Trời.`);
        
        // 4. Hiện Xuống
        drawParagraph(`4. ${formatDateVN(pentecost)} là Lễ Chúa Thánh Thần Hiện Xuống.`);
        
        // 5. Mình Máu Thánh
        drawParagraph(`5. ${formatDateVN(corpusChristi)} là Lễ Mình và Máu Thánh Chúa Kitô.`);
        
        // 6. Kitô Vua
        drawParagraph(`6. ${formatDateVN(christKing)} là Lễ Đức Giêsu Kitô Vua Vũ Trụ.`);
        
        // 7. Mùa Vọng
        drawParagraph(`7. ${formatDateVN(firstAdvent)} sẽ là Chúa Nhật Thứ Nhất Mùa Vọng, mong đợi Đức Giê-su Ki-tô Chúa chúng ta ngự đến.`);

        currentY += 20;
        
        // Kết
        drawParagraph("Nguyện chúc Ngài danh dự và vinh quang đến muôn đời. Amen.", false, true, 0);

        // Ký hiệu nhạc (trang trí)
        ctx.font = "italic 20px 'EB Garamond'";
        ctx.fillStyle = "#666";
        ctx.textAlign = "center";
        ctx.fillText("(Noveritis - Bản dịch 2024)", canvas.width/2, canvas.height - 50);
    }

    function downloadImage() {
        const canvas = document.getElementById('noveritisCanvas');
        const link = document.createElement('a');
        const year = document.getElementById('yearInput').value;
        link.download = `Noveritis_${year}.png`;
        link.href = canvas.toDataURL();
        link.click();
    }

    // Chạy lần đầu khi load trang
    window.onload = generateNoveritis;
</script>

</body>
</html>